<!DOCTYPE html><html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‚ú® Spyll Shop</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
  <div class="container">
    <h1>‚ú® Spyll Shop</h1><div class="product-list" id="product-list"></div>

<div class="payment-overlay" id="payment-modal">
  <div class="payment-box">
    <span class="close-btn" onclick="closeModal()">&times;</span>
    <h2>–û–ø–ª–∞—Ç–∞ –∑–∞–∫–∞–∑–∞</h2>
    <p><strong>–ü–µ—Ä–µ–≤–æ–¥ –Ω–∞ –∫–∞—Ä—Ç—É:</strong> 5355 2802 1897 6700</p>
    <p><strong>–°—É–º–º–∞ –∫ –æ–ø–ª–∞—Ç–µ:</strong> <span id="amount-display">0</span> UAH</p>
    <p><strong>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –ø–ª–∞—Ç–µ–∂—É:</strong> –ü–æ–¥–∞—Ä–æ–∫</p>
    <p>–ü–æ—Å–ª–µ –ø–µ—Ä–µ–≤–æ–¥–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç (.pdf / .jpg)</p>

    <input type="file" id="screenshot" />
    <button onclick="submitPayment()">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –û–ø–ª–∞—Ç—É</button>
  </div>
</div>

<div class="status-box" id="status-box" style="display:none">
  <span>‚è≥ –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–∞</span>
</div>

  </div>  <script>
    const tg = window.Telegram.WebApp;
    tg.expand();
    const user = tg.initDataUnsafe?.user;

    const products = [
      { id: 'premium3', title: 'Telegram Premium - 3 –º–µ—Å—è—Ü–∞', price: 0 },
      { id: 'premium6', title: 'Telegram Premium - 6 –º–µ—Å—è—Ü–µ–≤', price: 0 },
      { id: 'premium12', title: 'Telegram Premium - 12 –º–µ—Å—è—Ü–µ–≤', price: 0 },
      { id: 'stars', title: '–ü–æ–∫—É–ø–∫–∞ –∑–≤—ë–∑–¥', dynamic: true },
    ];

    let config = {
      star_price: 1,
      promo_min: 500,
      promo_price: 0.8
    };

    async function fetchPrices() {
      const res = await fetch('/api/config');
      config = await res.json();

      const list = document.getElementById('product-list');
      list.innerHTML = '';
      products.forEach(product => {
        const div = document.createElement('div');
        div.className = 'product';
        div.innerHTML = `
          <h3>${product.title}</h3>
          ${product.dynamic ? `
            <input type="number" id="starCount" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–≤—ë–∑–¥" oninput="updateStarPrice()">
            <p id="starPrice">–¶–µ–Ω–∞: 0 ‚Ç¥</p>
            <p class="promo-msg">üéÅ –ê–∫—Ü–∏—è –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ –æ—Ç ${config.promo_min} –∑–≤—ë–∑–¥ ‚Äî ${config.promo_price} ‚Ç¥ –∑–∞ –∑–≤–µ–∑–¥—É</p>
          ` : `<p>${product.price} ‚Ç¥</p>`}
          <button onclick="openModal('${product.id}')">–ö—É–ø–∏—Ç—å</button>
        `;
        list.appendChild(div);
      });
    }

    function updateStarPrice() {
      const count = parseInt(document.getElementById('starCount').value) || 0;
      const price = count >= config.promo_min ? config.promo_price * count : config.star_price * count;
      document.getElementById('starPrice').innerText = `–¶–µ–Ω–∞: ${price.toFixed(2)} ‚Ç¥`;
    }

    let currentProductId = '';
    function openModal(productId) {
      currentProductId = productId;
      let price = 0;
      if (productId === 'stars') {
        const count = parseInt(document.getElementById('starCount').value) || 0;
        price = count >= config.promo_min ? config.promo_price * count : config.star_price * count;
      } else {
        const product = products.find(p => p.id === productId);
        price = product.price;
      }
      document.getElementById('amount-display').innerText = price.toFixed(2);
      document.getElementById('payment-modal').style.display = 'flex';
    }

    function closeModal() {
      document.getElementById('payment-modal').style.display = 'none';
    }

    async function submitPayment() {
      const formData = new FormData();
      formData.append('productId', currentProductId);
      formData.append('userId', user?.id || 'unknown');
      formData.append('username', user?.username || '');
      formData.append('screenshot', document.getElementById('screenshot').files[0]);

      const res = await fetch('/api/submit-payment', {
        method: 'POST',
        body: formData
      });

      if (res.ok) {
        closeModal();
        document.getElementById('status-box').style.display = 'block';
      }
    }

    fetchPrices();
  </script></body>
</html>
